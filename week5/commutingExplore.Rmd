---
title: "Tidy Tuesday Week 5"
author: "Sara Stoudt"
date: "5/2/2018"
output: github_document
always_allow_html: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require(ggplot2)
require(maps)
require(dplyr)
require(plotly)
```

# Setup 
```{r,eval=F}
require(ggplot2)
require(maps)
require(dplyr)
require(plotly)
```

# Week 5 - County-level American Community Survey (5-year estimates) 2015
[RAW DATA](https://github.com/rfordatascience/tidytuesday/blob/master/data/acs2015_county_data.csv)  
[DataSource: census.gov](https://factfinder.census.gov/faces/nav/jsf/pages/index.xhtml)  
[Kaggle source](https://www.kaggle.com/muonneutrino/us-census-demographic-data)  

I'm building off of @AidoBo's function to plot continuous variables on a map.

<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">For <a href="https://twitter.com/hashtag/TidyTuesday?src=hash&amp;ref_src=twsrc%5Etfw">#TidyTuesday</a> I created simple function which allows you to plot any continuous variable in the data on a map <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> <a href="https://twitter.com/hashtag/r4ds?src=hash&amp;ref_src=twsrc%5Etfw">#r4ds</a> <a href="https://t.co/6Q1I121VqI">pic.twitter.com/6Q1I121VqI</a></p>&mdash; Aidan Boland (@AidoBo) <a href="https://twitter.com/AidoBo/status/991338257391804416?ref_src=twsrc%5Etfw">May 1, 2018</a></blockquote>
  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
  
  
```{r}
counties= map_data("county")
state=map_data("state")

  county_plot <-function(x){
  ## adapted from
  
  ##https://twitter.com/AidoBo/status/991338257391804416
  
  all_county$x<-all_county[,x] ## a different fix for this? something like aes_string?
  
  ggplot(data=counties,mapping=aes(x=long,y=lat,group=group))+
    geom_polygon(data=all_county, aes(fill=x),color="grey")+labs(fill=x)+scale_fill_distiller(palette="Spectral")+theme_void()+
    geom_path(data=state, aes(x=long,y=lat,group=group),color="black") ## add state boundaries
  
}
  
```

```{r}
setwd("~/Desktop/tidytuesday/data")

acs<-read.csv("acs2015_county_data.csv")

head(acs)
names(acs)

## from @AidoBo too
all_county<-inner_join(counties,acs %>% mutate(County=tolower(County),State=tolower(State)),by=c("subregion"="County","region"="State"))

```

# Commuting 

What are these hot spots?

```{r,fig.width=12}
p=county_plot("MeanCommute") 
p
```


**Where can commuting make you make more money?**

```{r}
p <- ggplot(acs, aes(x = MeanCommute, y = IncomePerCap, text =paste(County,State,sep="-"))) +
  geom_point() +xlab("mean commute")+
  ylab("income per cap")+ggtitle("Where Does/Doesn't Commuting Pay Off?")
p ## static for GitHub

#p <- ggplotly(p) ## hover to see county/state ids
#p
```

Can we get a rough idea of where it does and doesn't pay to commute on a map instead of relying on hovering?

```{r,fig.width=12}
## which counties have above average income and below average commute time per state (averages within a state)
averagesByState=group_by(acs,State)%>% summarize(avgMeanCommute=mean(MeanCommute),avgIncomePerCap=mean(IncomePerCap))


acsM=merge(acs,averagesByState,by.x="State",by.y="State",all.x=T)

acs$goodCommuteIncomeLevels=rep(0, nrow(acs))
acs$goodCommuteIncomeLevels[which(acsM$IncomePerCap>acsM$avgIncomePerCap & acsM$MeanCommute < acsM$avgMeanCommute)]=1

all_county<-inner_join(counties,acs %>% mutate(County=tolower(County),State=tolower(State)),by=c("subregion"="County","region"="State"))

#all_county$goodCommuteIncomeLevels=as.factor(all_county$goodCommuteIncomeLevels)
county_plot("goodCommuteIncomeLevels") ## need to make this discrete
```

# Work at Home

What  are these hot spots?

```{r,fig.width=12}
p=county_plot("WorkAtHome") 
p
```

A lot could be going on here, so I don't want to read to much into this plot. For example, we don't have income per person, so we don't know if those working from home make more or less than those in other jobs within their county. However, there are some interesting patterns here that it would be interesting to look into with data at the individual level. 

```{r}

ggplot(acs,aes(x=WorkAtHome,y=acs$IncomePerCap))+geom_point() +xlab("percentage working from home")+
  ylab("income per cap")+ggtitle("Does Working From Home Pay?")

```


# Transit

This is rather boring, but what is going on in Nevada?

```{r,fig.width=12}
county_plot("Transit")
``` 



